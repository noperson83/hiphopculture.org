{% extends "home/base.html" %}
{% load static %}

{% block title %}
<title>{{ group_detail.group_name }} - Profile</title>
<meta name="description" content="{{ group_detail.summary|default:'Group information' }}">
{% endblock %}

{% block breadcrumb %} / <a href="{% url 'group:group' %}">Groups</a> / {{ group_detail.group_name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <!-- Group Banner -->
        <div class="profile-banner" style="background-image: url('{{ group_detail.logo.url }}');">
            <div class="profile-pic-container">
                <img src="{{ group_detail.button.url }}" alt="{{ group_detail.group_name }} Logo" loading="lazy">
            </div>
        </div>

        <!-- Group Info -->
        <div class="group-info">
            <h1 class="group-name">{{ group_detail.group_name }}</h1>

            <!-- Social & Contact Links -->
            <div class="group-links">
                {% if group_detail.group_url %} <a href="{{ group_detail.group_url }}" target="_blank">üåê Website</a> {% endif %}
                {% if group_detail.facebook_url %} <a href="{{ group_detail.facebook_url }}" target="_blank">üìò Facebook</a> {% endif %}
                {% if group_detail.instagram_url %} <a href="{{ group_detail.instagram_url }}" target="_blank">üì∏ Instagram</a> {% endif %}
                {% if group_detail.twitter_url %} <a href="{{ group_detail.twitter_url }}" target="_blank">üê¶ Twitter</a> {% endif %}
            </div>
            <p class="group-summary">{{ group_detail.summary }}</p>
        </div>

        <!-- Tabs for Sections -->
        <div class="group-tabs">
            <button class="tab-link active" onclick="openTab(event, 'albums')">üéµ Albums</button>
            <button class="tab-link" onclick="openTab(event, 'members')">üë• Members</button>
            <button class="tab-link" onclick="openTab(event, 'events')">üé§ Events</button>
        </div>

        <!-- Albums Section -->
        <div id="albums" class="tab-content active">
            <div class="business-card">
                <h2>Albums</h2>
                <table width="100%" cellspacing="0" style="border-radius: 8%;">
                <tbody>
                {% if group_album_list %}
                    {% for album in group_album_list %}
                        <tr>
                        {% if album.cover_art %}
                            <td style="width: 150px;">
                            <a class="album-art" style="color:black;font-weight:bold;" href="{% url 'group:album-detail' album.id %}">
                                <img src="{{ album.cover_art.url }}" alt="Album Art" loading="lazy">
                            </a> 
                            </td>
                        {% else %}
                            <td style="width: 150px;">
                            <a class="album-art" style="color:black;font-weight:bold;" href="{% url 'group:album-detail' album.id %}">
                                <img src="{% static '/home/images/LMNlogo.jpg' %}" alt="Album Art" loading="lazy">
                            </a> 
                            </td>
                        {% endif %}
                        <td>
                            <div class="album-card">
                                <a style="color:black;font-weight:bold;" href="{% url 'group:album-detail' album.id %}">
                                    <h2>{{ album.title }}</h2>
                                </a>
                                <p>Released: {{ album.release_date }}</p>
                                <div class="stream-links">
                                    {% if album.spotify_link %}<a href="{{ album.spotify_link }}" target="_blank">Spotify</a>{% endif %}
                                    {% if album.apple_music_link %} | <a href="{{ album.apple_music_link }}" target="_blank">Apple Music</a>{% endif %}
                                </div>
                            </div>
                        </td>
                        </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td>There are no  </td>
                        <td>album </td>
                        <td>to list sorry!  </td>
                    </tr>
                {% endif %} 
                </tbody>
                </table>
            </div>

        <!-- Members Section -->
        <div id="members" class="tab-content">
            <div class="business-card">
                <h2>Members</h2>
                <table width="100%" cellspacing="0" style="border-radius: 8%;">
                    <tbody>
                        {% if group_member_list %}
                            {% for member in group_member_list %}
                            <tr>
                                {% if member.profile_pic %}
                                <td style="width: 150px;">
                                    <a class="album-art" style="color:black;font-weight:bold;" href="{% url 'munkz:artist-detail' member.pk %}">
                                    <img src="{{ member.profile_pic.url }}" alt="{{ member.display_name }}">
                                    </a> 
                                </td>
                                {% else %}
                                <td style="width: 150px;">
                                    <a class="album-art" style="color:black;font-weight:bold;" href="{% url 'munkz:artist-detail' member.pk %}">
                                        <img src="{% static '/home/images/LMNlogo.jpg' %}" alt="Album Art">
                                    </a> 
                                </td>
                                {% endif %}
                                <td>
                                <div class="album-card">
                                    <a style="color:black;font-weight:bold;" href="{% url 'munkz:artist-detail' member.pk %}">
                                    <a href="{% url 'munkz:artist-detail' member.pk %}">{{ member.get_full_name }}</a>
                                    </a> 
                                </div>
                                </td>
                            </tr>
                        {% endfor %}
                        {% else %}
                            <tr>
                                <td><p>No members </p>  </td>
                                <td>in this </td>
                                <td>group sorry!  </td>
                            </tr>
                        {% endif %} 
                    </tbody>
                </table>                        
            </div>
        </div>

        <!-- Events Section -->
        <div id="events" class="tab-content">
            <h2>Upcoming Events</h2>
            <iframe src="{% url 'schedule:compact_calendar' group_detail.group_name|slugify %}" class="mini-calendar"></iframe>
            <p class="event-note">If no events appear, please check back soon!</p>
        </div>

        <!-- Contact Info -->
        <div class="group-contact">
            <h3>Contact</h3>
            <p><strong>Manager:</strong> {{ group_detail.first_name }} {{ group_detail.last_name }}</p>
            <p><strong>Email:</strong>
                {% if group_detail.contact_email %}
                    <a href="mailto:{{ group_detail.contact_email }}">{{ group_detail.contact_email }}</a>
                {% else %}Not provided{% endif %}
            </p>
            <p><strong>Phone:</strong> {{ group_detail.contact_phone|default:'Not provided' }}</p>
            <p><strong>Address:</strong><br>
                {{ group_detail.billing_address|default:'' }}<br>
                {{ group_detail.billing_address_city|default:'' }}{% if group_detail.billing_address_state %}, {{ group_detail.billing_address_state }}{% endif %} {{ group_detail.billing_address_zipcode|default:'' }}</p>
        </div>
    </div>
</div>

<script>
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tab-link");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.classList.add("active");
    }
</script>
<style>
/* Profile Banner */
.profile-banner {
    width: 100%;
    height: 250px;
    background-size: cover;
    background-position: center;
    position: relative;
}

/* Profile Picture */
.profile-pic-container {
    position: absolute;
    bottom: -50px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 120px;
    border-radius: 50%;
    overflow: hidden;
    border: 5px solid white;
}
.profile-pic-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Group Info */
.group-name {
    margin-top: 60px;
    font-size: 28px;
}
.group-summary {
    font-size: 16px;
    color: #666;
    margin-top: 5px;
}

/* Social Links */
.group-links {
    margin-top: 10px;
}
.group-links a {
    text-decoration: none;
    margin: 5px;
    padding: 8px 12px;
    background: #222;
    color: white;
    border-radius: 5px;
    display: inline-block;
}

/* Tabs */
.group-tabs {
    margin-top: 20px;
}
.tab-link {
    background: #eee;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    margin: 5px;
}
.tab-link.active {
    background: #333;
    color: white;
}

/* Tab Content */
.tab-content {
    display: none;
    padding: 20px;
    background: #f8f8f8;
    border-radius: 5px;
}
.tab-content.active {
    display: block;
}

/* Mini Calendar */
.mini-calendar {
    width: 100%;
    height: 250px;
    border: none;
}

/* Responsive */
@media screen and (max-width: 600px) {
    .profile-banner {
        height: 180px;
    }
    .profile-pic-container {
        width: 90px;
        height: 90px;
        bottom: -40px;
    }
    .group-name {
        font-size: 22px;
    }
    .tab-link {
        padding: 8px;
        font-size: 14px;
    }
}
</style>
{% endblock %}
